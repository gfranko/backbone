(function(){var a=Backbone.Model=function(a,b){var c;a||(a={}),b&&b.collection&&(this.collection=b.collection),b&&b.parse&&(a=this.parse(a));if(c=_.result(this,"defaults"))a=_.extend({},c,a);this.attributes={},this._escapedAttributes={},this.cid=_.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(a,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=_.clone(this.attributes),this.initialize.apply(this,arguments)};_.extend(a.prototype,Backbone.Events,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var c=this.get(a);return this._escapedAttributes[a]=_.escape(c==null?"":""+c)},has:function(a){return this.get(a)!=null},set:function(b,c,d){var e,f,g;_.isObject(b)||b==null?(e=b,d=c):(e={},e[b]=c),d||(d={});if(!e)return this;e instanceof a&&(e=e.attributes);if(d.unset)for(f in e)e[f]=void 0;if(!this._validate(e,d))return!1;this.idAttribute in e&&(this.id=e[this.idAttribute]);var h=d.changes={},i=this.attributes,j=this._escapedAttributes,k=this._previousAttributes||{};for(f in e){g=e[f];if(!_.isEqual(i[f],g)||d.unset&&_.has(i,f))delete j[f],(d.silent?this._silent:h)[f]=!0;d.unset?delete i[f]:i[f]=g,!_.isEqual(k[f],g)||_.has(i,f)!==_.has(k,f)?(this.changed[f]=g,d.silent||(this._pending[f]=!0)):(delete this.changed[f],delete this._pending[f])}return d.silent||this.change(d),this},unset:function(a,b){return b=_.extend({},b,{unset:!0}),this.set(a,null,b)},clear:function(a){return a=_.extend({},a,{unset:!0}),this.set(_.clone(this.attributes),a)},fetch:function(a){a=a?_.clone(a):{};var b=this,c=a.success;return a.success=function(d,e,f){if(!b.set(b.parse(d,f),a))return!1;c&&c(b,d,a)},this.sync("read",this,a)},save:function(a,b,c){var d,e,f;_.isObject(a)||a==null?(d=a,c=b):(d={},d[a]=b),c=c?_.clone(c):{};if(c.wait){if(!this._validate(d,c))return!1;e=_.clone(this.attributes)}var g=_.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?g:c))return!1;if(!d&&!this.isValid())return!1;var h=this,i=c.success;c.success=function(a,b,e){f=!0;var g=h.parse(a,e);c.wait&&(g=_.extend(d||{},g));if(!h.set(g,c))return!1;i&&i(h,a,c)};var j=this.sync(this.isNew()?"create":"update",this,c);return!f&&c.wait&&(this.clear(g),this.set(e,g)),j},destroy:function(a){a=a?_.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a)};if(this.isNew())return a.success(),!1;var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?a:a+(a.charAt(a.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=_.extend({},a.changes,this._silent);this._silent={};for(var c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;while(!_.isEmpty(this._pending)){this._pending={},this.trigger("change",this,a);for(var c in this.changed){if(this._pending[c]||this._silent[c])continue;delete this.changed[c]}this._previousAttributes=_.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(a){return a==null?!_.isEmpty(this.changed):_.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?_.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes;for(var e in a){if(_.isEqual(d[e],b=a[e]))continue;(c||(c={}))[e]=b}return c},previous:function(a){return a==null||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return _.clone(this._previousAttributes)},isValid:function(a){return!this.validate||!this.validate(this.attributes,a)},_validate:function(a,b){if(b.silent||!this.validate)return!0;a=_.extend({},this.attributes,a);var c=this.validate(a,b);return c?(b&&b.error&&b.error(this,c,b),this.trigger("error",this,c,b),!1):!0}}),a.extend=Backbone.extend}).call(this);